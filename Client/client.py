import socket
import threading

import json

# DA OGGETTO A STRINGA
def stringifyObject(obj):
    try:
        stringa_json = json.dumps(obj)
        return stringa_json
    except (TypeError, ValueError) as e:
        print(f"Errore nella conversione dell'oggetto in stringa: {e}")
        return None

def parseObject(stringa):
    try:
        obj = json.loads(stringa)
        return obj
    except (json.JSONDecodeError, TypeError) as e:
        print(f"Errore nella conversione della stringa in oggetto: {e}")
        return None

def riceviJson(qta = 1024):
    return parseObject(client.recv(qta).decode("utf-8"))

def inviaJSON(messaggio):
    client.send(stringifyObject(messaggio).encode())

#Host = "172.27.128.1" MAXWELL PC LEO
#Host = "192.168.178.24" PC LEO CASA
Host = "192.168.178.24"
Host = socket.gethostbyname(socket.gethostname())
Porta = 9999

Indirizzo = (Host, Porta)

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)


def waitForGame(nickname, resolver, error):
    threading.Thread(target=connect, args=(nickname, resolver, error)).start()

def connect(nickname, resolver, error):
    try:
        # Prova a connettersi al server
        client.connect(Indirizzo)
        inviaJSON({"nome": nickname})
        resolver(riceviJson())
    except socket.error as e:
        # Gestisce errori di connessione
        client.close()
        error(f'Impossibile Collegarsi al Server\n\n({e})')


turn = False


def clickCard(obj):
    pass
    """ if turn:
        if possofaremossa:
            turn = not turn
            inviaJSON({mossa})
            mossa = riceviJson()
    else:
        turn = not turn """
        #TUTTO IL CODICE STA DENTRO SE E' IL MIO TURNO
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP
        #FAI FUNZIONE CHE CERCA E TROVA TUTTE LE COMBINAZIONI DELLE MOSSE POSSIBILI CON LA CARTA CHE SELEZIONI DAL TUO MAZZP